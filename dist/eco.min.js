/*!
 * eco.js - v0.4.0-alpha
 * Built Sun, 10th Dec 2017 17:17:50 UTC
 *
 * https://github.com/lajohnston/eco
 *
 * eco.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */
 !function(){"use strict";function t(t,e){this.entity=t,this.component=e,this.next=void 0}function e(t,e){for(var n=0;n<e.length;n++)if(!t.has(e[n]))return!1;return!0}function n(){return new f}function i(t,e,n){return new l(t,e,n)}function o(){var t=function(t){function e(){return r(this,e),u(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return c(e,t),e}(a);return new Eco(t,n(),i)}var r=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},s=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),c=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},u=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},h=Object.create(null),a=function(){function t(e){r(this,t),this.eco=e,this.components=Object.create(h),this._enabled=!0}return s(t,[{key:"has",value:function(t){return void 0!==this.components[t]}},{key:"removeAll",value:function(){var t=this;return Object.keys(this.components).forEach(function(e){t[e]=void 0}),this}},{key:"getComponents",value:function(){var t=this,e={};return Object.keys(this.components).forEach(function(n){e[n]=t.components[n]}),e}},{key:"enabled",get:function(){return this._enabled},set:function(t){var e=this._enabled,n=!!t;e!==n&&(this._enabled=n,this.eco.onEntityStatusChanged(this,this._enabled))}}],[{key:"defineComponent",value:function(t){Object.defineProperty(this.prototype,t,{enumerable:!0,configurable:!0,get:function(){return this.components[t]},set:function(e){var n=this.components[t];this.components[t]=e,this._enabled&&this.eco.onComponentChanged(this,t,e,n)}})}}]),t}(),Eco=function(){function Eco(t,e,n){r(this,Eco),this.Entity=t,this.entities=e,this.createFilterInstance=n,this.onChange=function(){}}return s(Eco,[{key:"onEntityStatusChanged",value:function(t,e){e?this.entities.add(t):this.entities.remove(t)}},{key:"onComponentChanged",value:function(t,e,n,i){void 0!==n&&void 0!==i||n===i||this.entities.incVersion(t,e),this.onChange(t,e,n,i)}},{key:"defineComponents",value:function(t){var e=this;t.forEach(function(t){e.Entity.defineComponent(t)})}},{key:"entity",value:function(){var t=new this.Entity(this);return this.entities.add(t),t}},{key:"createFilter",value:function(t,e){return this.createFilterInstance(this.entities,t,e)}},{key:"system",value:function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[0],o=3===e.length?e[1]:void 0,r=3===e.length?e[2]:e[1],s=this.createFilter(i,o);return function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];s.forEach(function(t){r.apply(void 0,[t].concat(e))})}}},{key:"all",get:function(){return this.entities.entities}}]),Eco}();t.prototype.supersede=function(e,n){var i=new t(e,n);return this.next=i,i};var f=function(){function e(){r(this,e),this.entities=[],this.version=new t}return s(e,[{key:"add",value:function(t){this.entities.push(t),this.incVersion(t)}},{key:"remove",value:function(t){this.entities=this.entities.filter(function(e){return e!==t}),this.incVersion(t)}},{key:"incVersion",value:function(t,e){this.version=this.version.supersede(t,e)}},{key:"filter",get:function(){return this.entities.filter.bind(this.entities)}}]),e}(),l=function(){function t(n,i,o){r(this,t),this.entities=n,this.components=i,this.criteria=o||function(t){return e(t,i)},this.cacheVersion={},this.cached=[]}return s(t,[{key:"forEach",value:function(t){this.filtered.forEach(t)}},{key:"filtered",get:function(){return this.cacheVersion!==this.entities.version&&(this.cached=this.entities.filter(this.criteria),this.cacheVersion=this.entities.version),this.cached}}]),t}();window.Eco=o}();